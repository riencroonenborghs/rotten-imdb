(()=>{"use strict";class t{constructor(t){this.text=t,this.regExp=/([0-9]{4})|(S([0-9]*)E([0-9]*))|([0-9]*)p/}get query(){let t=[];return this._parts.forEach((e=>{null===e.match(this.regExp)&&t.push(e)})),t.join(" ")}get _parts(){const t=this.text.replace(/\./g," ").split(/[ \/]/);return""===t[t.length-1]&&t.pop(),t}}class e{set title(t){this._title=t}get title(){return this._title}set year(t){this._year=t}get year(){return this._year}set score(t){this._score=t}get score(){return this._score}set state(t){this._state=t}get state(){return this._state}set url(t){this._url=t}get url(){return this._url}get contextMenuTitle(){return`${this.score?this.score:"??"} ${this.state.match(/fresh/)?":)":":("} ${this.title} (${this.year})`}}class r{constructor(t){this.element=document.createElement("div"),this.element.insertAdjacentHTML("beforeend",t)}parse(){const t=[];return this._movies.forEach((e=>{t.push(this._parseMovie(e))})),t}get _movies(){return this.element.querySelectorAll("search-page-result[slot='movie'] ul[slot='list'] search-page-media-row[skeleton='panel']")}_parseMovie(t){const r=this._title(t),s=this._attribute(t,"releaseyear"),o=this._attribute(t,"tomatometerscore"),n=this._attribute(t,"tomatometerstate"),i=this._url(t);return Object.assign(new e,{title:r,year:s,score:o,state:n,url:i})}_titleNode(t){return t.querySelector("a[slot='title']")}_title(t){return this._titleNode(t).childNodes[0].nodeValue.split("\n")[1].trim()}_url(t){return this._attribute(this._titleNode(t),"href")}_attribute(t,e){return t.attributes.getNamedItem(e).value}}class s{constructor(t){this.query=t,this.baseUrl="https://www.rottentomatoes.com/search?search="}parse(){return fetch(this.url).then((t=>t.text())).then((t=>new r(t).parse()))}get url(){return`${this.baseUrl}${this._encodedQuery}`}get _encodedQuery(){return encodeURI(this.query)}}const o=new class{init(){chrome.contextMenus.removeAll(),chrome.contextMenus.create(this.mainOptions)}afterSearch(t){chrome.contextMenus.removeAll(),chrome.contextMenus.create(this.afterSearchOptions),chrome.contextMenus.create({id:"rottenTomatesSep1",type:"separator",contexts:["all"]}),chrome.contextMenus.create({id:"rottenTomatesQuery",title:t,contexts:["all"]}),chrome.contextMenus.create({id:"rottenTomatesSep2",type:"separator",contexts:["all"]})}forMovie(t){chrome.contextMenus.create({id:`rottenTomatoes${t.title}`,title:t.contextMenuTitle,contexts:["all"],onclick:function(){chrome.tabs.create({url:t.url,active:!1})}})}get mainOptions(){return{id:"rottenTomatoes",contexts:["selection"],title:"Rotten Tomatoes",onclick:function(e){const r=e.selectionText,s=new t(r);chrome.storage.local.remove("rottenTomatoes"),chrome.storage.local.set({rottenTomatoes:{query:s.query}})}}}get afterSearchOptions(){const t=this.mainOptions;return t.title="New Rotten Tomatoes Search",t}};o.init(),chrome.storage.onChanged.addListener(((t,e)=>{const r=t?.rottenTomatoes?.newValue?.query;null!==r&&new s(r).parse().then((t=>{o.afterSearch(r),t.forEach((t=>o.forMovie(t)))}))}))})();