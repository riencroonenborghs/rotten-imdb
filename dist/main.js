(()=>{"use strict";class t{constructor(t){this.text=t,this.regExp=/([0-9]{4})|(S([0-9]*)E([0-9]*))|([0-9]*)p/}get query(){let t=[];return this._parts.forEach((e=>{null===e.match(this.regExp)&&t.push(e)})),t.join(" ")}get _parts(){const t=this.text.replace(/\./g," ").split(/[ \/]/);return""===t[t.length-1]&&t.pop(),t}}class e{constructor(t){this.query=t}search(){return fetch(this.url).then((t=>t.text())).then((t=>this.parse(t)))}get baseUrl(){throw"#baseUrl implement me!"}get url(){return`${this.baseUrl}${this.encodedQuery}`}get encodedQuery(){return encodeURI(this.query)}}class r{constructor(t){this.element=document.createElement("div"),this.element.insertAdjacentHTML("beforeend",t)}_titleNode(t){return t.querySelector("a[slot='title']")}_title(t){return this._titleNode(t).childNodes[0].nodeValue.split("\n")[1].trim()}_url(t){return this._attribute(this._titleNode(t),"href")}_attribute(t,e){return t.attributes.getNamedItem(e).value}}class s{set title(t){this._title=t}get title(){return this._title}set year(t){this._year=t}get year(){return this._year}set score(t){this._score=t}get score(){return this._score}set state(t){this._state=t}get state(){return this._state}set url(t){this._url=t}get url(){return this._url}get contextMenuTitle(){const t=this.score?this.score:"??";let e="";return this.state&&(e=this.state.match(/fresh/)?":)":":("),`${t} ${e} ${this.title} (${this.year})`}}class o extends r{constructor(t){super(t),this._movies=[]}get movies(){return this._movies}parse(){this._allNodes.forEach((t=>{this._movies.push(this._parseTopNode(t))}))}get _allNodes(){return this.element.querySelectorAll("search-page-result[slot='movie'] ul[slot='list'] search-page-media-row[skeleton='panel']")}_parseTopNode(t){const e=this._title(t),r=this._attribute(t,"releaseyear"),o=this._attribute(t,"tomatometerscore"),i=this._attribute(t,"tomatometerstate"),a=this._url(t);return Object.assign(new s,{title:e,year:r,score:o,state:i,url:a})}}class i{set title(t){this._title=t}get title(){return this._title}set year(t){this._year=t}get year(){return this._year}set score(t){this._score=t}get score(){return this._score}set state(t){this._state=t}get state(){return this._state}set url(t){this._url=t}get url(){return this._url}get contextMenuTitle(){const t=this.score?this.score:"??";let e="";return this.state&&(e=this.state.match(/fresh/)?":)":":("),`${t} ${e} ${this.title} (${this.year})`}}class a extends r{constructor(t){super(t),this._tvShows=[]}get tvShows(){return this._tvShows}parse(){this._allNodes.forEach((t=>{this._tvShows.push(this._parseTopNode(t))}))}get _allNodes(){return this.element.querySelectorAll("search-page-result[slot='tv'] ul[slot='list'] search-page-media-row[skeleton='panel']")}_parseTopNode(t){const e=this._title(t),r=this._attribute(t,"startyear"),s=this._attribute(t,"tomatometerscore"),o=this._attribute(t,"tomatometerstate"),a=this._url(t);return Object.assign(new i,{title:e,year:r,score:s,state:o,url:a})}}class n extends e{get baseUrl(){return"https://www.rottentomatoes.com/search?search="}parse(t){const e=new o(t),r=new a(t);return e.parse(),r.parse(),{movies:e,tvShows:r}}}class l extends r{constructor(t){super(t),this._movies=[]}get movies(){return this._movies}parse(){this._allNodes.forEach((t=>{this._movies.push(this._parseTopNode(t))}))}get _allNodes(){return this.element.querySelectorAll("#main .article .lister.list.detail.sub-list .lister-list .lister-item .lister-item-content")}_parseTopNode(t){const e=t.querySelector(".lister-item-header"),r=e.querySelector("a"),o=r?.innerText||"asd",i=`https://www.imdb.com/${this._attribute(r,"href")}`,a=e.querySelector(".lister-item-year")?.innerText,n=t.querySelector(".ratings-bar .ratings-imdb-rating strong")?.innerText;return Object.assign(new s,{title:o,year:a,score:n,state:null,url:i})}}class c extends e{get baseUrl(){return"https://www.imdb.com/search/title/?title_type=feature&title="}parse(t){const e=new l(t);return e.parse(),e}}class h extends r{constructor(t){super(t),this._tvShows=[]}get tvShows(){return this._tvShows}parse(){this._allNodes.forEach((t=>{this._tvShows.push(this._parseTopNode(t))}))}get _allNodes(){return this.element.querySelectorAll("#main .article .lister.list.detail.sub-list .lister-list .lister-item .lister-item-content")}_parseTopNode(t){const e=t.querySelector(".lister-item-header"),r=e.querySelector("a"),s=r?.innerText||"asd",o=this._attribute(r,"href"),a=e.querySelector(".lister-item-year")?.innerText,n=t.querySelector(".ratings-bar .ratings-imdb-rating strong")?.innerText;return Object.assign(new i,{title:s,year:a,score:n,state:null,url:o})}}class u extends e{get baseUrl(){return"https://www.imdb.com/search/title/?title_type=tv_series&title="}parse(t){const e=new h(t);return e.parse(),e}}const m=new class{constructor(){this.separatorCount=0}onInit(){chrome.contextMenus.removeAll(),chrome.contextMenus.create({id:"rottenIMDB-rottentomatoes",contexts:["selection"],title:"Rotten Tomatoes",onclick:function(e){const r=e.selectionText,s=new t(r);chrome.storage.local.remove("rottenIMDB"),chrome.storage.local.set({rottenIMDB:{rotten:{query:s.query}}})}}),chrome.contextMenus.create({id:"rottenIMDB-imdb",contexts:["selection"],title:"IMDB",onclick:function(e){const r=e.selectionText,s=new t(r);chrome.storage.local.remove("rottenIMDB"),chrome.storage.local.set({rottenIMDB:{imdb:{query:s.query}}})}})}addSeparator(){chrome.contextMenus.create({id:`rottenIMDB-sep-${this.separatorCount}`,type:"separator",contexts:["all"]}),this.separatorCount+=1}afterSearch(t){this.onInit(),this.addSeparator()}forMovie(t){chrome.contextMenus.create({id:`rottenIMDB-${t.title}`,title:t.contextMenuTitle,contexts:["all"],onclick:function(){chrome.tabs.create({url:t.url,active:!1})}})}forTvShow(t){chrome.contextMenus.create({id:`rottenIMDB-${t.title}`,title:t.contextMenuTitle,contexts:["all"],onclick:function(){chrome.tabs.create({url:t.url,active:!1})}})}};m.onInit(),chrome.storage.onChanged.addListener(((t,e)=>{const r=t?.rottenIMDB?.newValue;var s;r?.rotten?.query?(s=r?.rotten?.query,new n(s).search().then((t=>{m.afterSearch(s),t.movies.movies.forEach(((t,e)=>{e<5&&m.forMovie(t)})),m.addSeparator(),t.tvShows.tvShows.forEach(((t,e)=>{e<5&&m.forTvShow(t)}))}))):r?.imdb?.query&&(t=>{const e=new c(t),r=new u(t);e.search().then((e=>{m.afterSearch(t),e.movies.forEach(((t,e)=>{e<5&&m.forMovie(t)})),m.addSeparator(),r.search().then((t=>{t.tvShows.forEach(((t,e)=>{e<5&&m.forTvShow(t)}))}))}))})(r?.imdb?.query)}))})();