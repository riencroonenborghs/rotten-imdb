(()=>{"use strict";class t{constructor(t){this.text=t,this.regExp=/([0-9]{4})|(S([0-9]*)E([0-9]*))|([0-9]*)p/}get query(){let t=[];return this._parts.forEach((e=>{null===e.match(this.regExp)&&t.push(e)})),t.join(" ")}get _parts(){const t=this.text.replace(/\./g," ").split(/[ \/]/);return""===t[t.length-1]&&t.pop(),t}}class e{constructor(t){this.query=t}search(){return fetch(this.url).then((t=>t.text())).then((t=>this.parse(t)))}get baseUrl(){throw"#baseUrl implement me!"}get url(){return`${this.baseUrl}${this.encodedQuery}`}get encodedQuery(){return encodeURI(this.query)}}class r{constructor(t){this.element=document.createElement("div"),this.element.insertAdjacentHTML("beforeend",t)}_titleNode(t){return t.querySelector("a[slot='title']")}_title(t){return this._titleNode(t).childNodes[0].nodeValue.split("\n")[1].trim()}_url(t){return this._attribute(this._titleNode(t),"href")}_attribute(t,e){return t.attributes.getNamedItem(e).value}}class s{set title(t){this._title=t}get title(){return this._title}set year(t){this._year=t}get year(){return this._year}set score(t){this._score=t}get score(){return this._score}set state(t){this._state=t}get state(){return this._state}set url(t){this._url=t}get url(){return this._url}get contextMenuTitle(){const t=this.score?this.score:"??",e="";return this.state&&(e=this.state.match(/fresh/)?":)":":("),`${t} ${e} ${this.title} (${this.year})`}}class o extends r{constructor(t){super(t),this._movies=[]}get movies(){return this._movies}parse(){this._allNodes.forEach((t=>{this._movies.push(this._parseTopNode(t))}))}get _allNodes(){return this.element.querySelectorAll("#main .article .lister.list.detail.sub-list .lister-list .lister-item .lister-item-content")}_parseTopNode(t){const e=t.querySelector(".lister-item-header"),r=e.querySelector("a"),o=r?.innerText||"asd",i=`https://www.imdb.com/${this._attribute(r,"href")}`,n=e.querySelector(".lister-item-year")?.innerText,a=t.querySelector(".ratings-bar .ratings-imdb-rating strong")?.innerText;return Object.assign(new s,{title:o,year:n,score:a,state:null,url:i})}}class i extends e{get baseUrl(){return"https://www.imdb.com/search/title/?title_type=feature&title="}parse(t){const e=new o(t);return e.parse(),e}}class n{set title(t){this._title=t}get title(){return this._title}set year(t){this._year=t}get year(){return this._year}set score(t){this._score=t}get score(){return this._score}set state(t){this._state=t}get state(){return this._state}set url(t){this._url=t}get url(){return this._url}get contextMenuTitle(){const t=this.score?this.score:"??",e="";return this.state&&(e=this.state.match(/fresh/)?":)":":("),`${t} ${e} ${this.title} (${this.year})`}}class a extends r{constructor(t){super(t),this._tvShows=[]}get tvShows(){return this._tvShows}parse(){this._allNodes.forEach((t=>{this._tvShows.push(this._parseTopNode(t))}))}get _allNodes(){return this.element.querySelectorAll("#main .article .lister.list.detail.sub-list .lister-list .lister-item .lister-item-content")}_parseTopNode(t){const e=t.querySelector(".lister-item-header"),r=e.querySelector("a"),s=r?.innerText||"asd",o=this._attribute(r,"href"),i=e.querySelector(".lister-item-year")?.innerText,a=t.querySelector(".ratings-bar .ratings-imdb-rating strong")?.innerText;return Object.assign(new n,{title:s,year:i,score:a,state:null,url:o})}}class l extends e{get baseUrl(){return"https://www.imdb.com/search/title/?title_type=tv_series&title="}parse(t){const e=new a(t);return e.parse(),e}}const c=new class{constructor(){this.separatorCount=0}onInit(){chrome.contextMenus.removeAll(),chrome.contextMenus.create({id:"rottenTomatoes",contexts:["selection"],title:"Rotten Tomatoes",onclick:function(e){const r=e.selectionText,s=new t(r);chrome.storage.local.remove("rottenTomatoes"),chrome.storage.local.set({rottenTomatoes:{query:s.query}})}})}addSeparator(){chrome.contextMenus.create({id:`rottenTomatesSep${this.separatorCount}`,type:"separator",contexts:["all"]}),this.separatorCount+=1}afterSearch(e){chrome.contextMenus.removeAll(),chrome.contextMenus.create({id:"rottenTomatoes",contexts:["selection"],title:"New Rotten Tomatoes Search",onclick:function(e){const r=e.selectionText,s=new t(r);chrome.storage.local.remove("rottenTomatoes"),chrome.storage.local.set({rottenTomatoes:{query:s.query}})}}),this.addSeparator()}forMovie(t){chrome.contextMenus.create({id:`rottenTomatoes${t.title}`,title:t.contextMenuTitle,contexts:["all"],onclick:function(){chrome.tabs.create({url:t.url,active:!1})}})}forTvShow(t){chrome.contextMenus.create({id:`rottenTomatoes${t.title}`,title:t.contextMenuTitle,contexts:["all"],onclick:function(){chrome.tabs.create({url:t.url,active:!1})}})}};c.onInit(),chrome.storage.onChanged.addListener(((t,e)=>{const r=t?.rottenTomatoes?.newValue?.query;r&&(t=>{const e=new i(t),r=new l(t);e.search().then((e=>{c.afterSearch(t),e.movies.forEach(((t,e)=>{e<5&&c.forMovie(t)})),c.addSeparator(),r.search().then((t=>{t.tvShows.forEach(((t,e)=>{e<5&&c.forTvShow(t)}))}))}))})(r)}))})();